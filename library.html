<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .nav-link {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .nav-link:hover {
            background-color: #e5e7eb;
        }
        .nav-link.active {
            background-color: #1d4ed8;
            color: white;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }
        .btn-primary {
            background-color: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .btn-danger {
            background-color: #dc2626;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
        }
        .btn-danger:hover {
            background-color: #b91c1c;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <nav class="bg-white shadow-md py-4 px-6 flex flex-col md:flex-row justify-between items-center sticky top-0 z-50">
        <div class="flex items-center mb-4 md:mb-0">
            <h1 class="text-2xl font-bold text-blue-700 mr-6">My Library</h1>
            <div class="flex flex-wrap gap-2 md:gap-4">
                <a href="#" class="nav-link active" data-section="dashboard">Dashboard</a>
                <a href="#" class="nav-link" data-section="books">Books</a>
                <a href="#" class="nav-link" data-section="myIssuedBooks">My Issued Books</a>
                <a href="#" class="nav-link" data-section="fine">Fine</a>
            </div>
        </div>
        <div class="flex items-center gap-4 w-full md:w-auto">
            <div class="relative w-full md:w-auto">
                <input type="text" id="searchBar" placeholder="Search books..." class="w-full md:w-64 py-2 pl-10 pr-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            </div>
            <div class="relative">
                <button id="userOptionsBtn" class="flex items-center gap-2 py-2 px-4 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    <span>User</span>
                </button>
                <div id="userOptionsDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-10">
                    <p class="px-4 py-2 text-sm text-gray-700">Library ID: <span id="libraryIdDisplay" class="font-semibold"></span></p>
                    <a href="#" id="changePasswordLink" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Change Password</a>
                    <a href="#" id="logoutLink" class="block px-4 py-2 text-red-600 hover:bg-gray-100">Logout</a>
                </div>
            </div>
        </div>
    </nav>
    <main id="content" class="flex-grow container mt-8 mb-8"></main>
    <div id="changePasswordModal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('changePasswordModal')">&times;</button>
            <h2 class="text-xl font-semibold mb-4">Change Password</h2>
            <form id="changePasswordForm" class="space-y-4">
                <div>
                    <label for="currentPassword" class="block text-sm font-medium text-gray-700">Current Password</label>
                    <input type="password" id="currentPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="newPassword" class="block text-sm font-medium text-gray-700">New Password</label>
                    <input type="password" id="newPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                    <input type="password" id="confirmNewPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <button type="submit" class="btn-primary w-full">Change Password</button>
            </form>
            <p id="passwordChangeMessage" class="mt-4 text-center text-sm"></p>
        </div>
    </div>
    <div id="messageModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 id="messageModalTitle" class="text-xl font-semibold mb-4"></h2>
            <p id="messageModalContent" class="mb-6"></p>
            <div class="flex justify-end gap-3">
                <button id="messageModalConfirmBtn" class="btn-primary hidden">Confirm</button>
                <button id="messageModalCloseBtn" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>
   <script>
    let books = [
        { id: 'b001', title: 'The Great Gatsby', author: 'F. Scott Fitzgerald', available: true },
        { id: 'b002', title: '1984', author: 'George Orwell', available: true },
        { id: 'b003', title: 'To Kill a Mockingbird', author: 'Harper Lee', available: true },
        { id: 'b004', title: 'Pride and Prejudice', author: 'Jane Austen', available: true },
        { id: 'b005', title: 'The Catcher in the Rye', author: 'J.D. Salinger', available: true },
        { id: 'b006', title: 'The Hobbit', author: 'J.R.R. Tolkien', available: true },
        { id: 'b007', title: 'Lord of the Flies', author: 'William Golding', available: true },
        { id: 'b008', title: 'Animal Farm', author: 'George Orwell', available: true },
        { id: 'b009', title: 'Brave New World', author: 'Aldous Huxley', available: true },
        { id: 'b010', title: 'The Odyssey', author: 'Homer', available: true }
    ];

    let issuedBooks = [];
    let currentUser = {
        libraryNumber: 'LIB' + Math.random().toString(36).substring(2, 10).toUpperCase(),
        password: 'password123'
    };

    const contentDiv = document.getElementById('content');
    const navLinks = document.querySelectorAll('.nav-link');
    const searchBar = document.getElementById('searchBar');
    const userOptionsBtn = document.getElementById('userOptionsBtn');
    const userOptionsDropdown = document.getElementById('userOptionsDropdown');
    const libraryIdDisplay = document.getElementById('libraryIdDisplay');
    const changePasswordLink = document.getElementById('changePasswordLink');
    const logoutLink = document.getElementById('logoutLink');
    const changePasswordModal = document.getElementById('changePasswordModal');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const passwordChangeMessage = document.getElementById('passwordChangeMessage');

    const messageModal = document.getElementById('messageModal');
    const messageModalTitle = document.getElementById('messageModalTitle');
    const messageModalContent = document.getElementById('messageModalContent');
    const messageModalConfirmBtn = document.getElementById('messageModalConfirmBtn');
    const messageModalCloseBtn = document.getElementById('messageModalCloseBtn');

    function showMessageModal(title, content, isConfirm = false) {
        return new Promise((resolve) => {
            messageModalTitle.textContent = title;
            messageModalContent.textContent = content;
            messageModalConfirmBtn.onclick = () => {
                closeModal('messageModal');
                resolve(true);
            };
            messageModalCloseBtn.onclick = () => {
                closeModal('messageModal');
                resolve(false);
            };
            if (isConfirm) {
                messageModalConfirmBtn.classList.remove('hidden');
            } else {
                messageModalConfirmBtn.classList.add('hidden');
            }
            messageModal.classList.remove('hidden');
        });
    }

    function openModal(modalId) {
        document.getElementById(modalId).classList.remove('hidden');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }

    function updateActiveNav(sectionId) {
        navLinks.forEach(link => {
            if (link.dataset.section === sectionId) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    function renderDashboard() {
        updateActiveNav('dashboard');
        contentDiv.innerHTML = `
            <div class="card p-6">
                <h2 class="text-3xl font-bold text-blue-700 mb-4">Welcome to My Library!</h2>
                <p class="text-lg text-gray-700 mb-6">Your unique Library ID is: <span class="font-semibold text-blue-600">${currentUser.libraryNumber}</span></p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-blue-100 p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">Total Books</h3>
                        <p class="text-3xl font-bold text-blue-900">${books.length}</p>
                    </div>
                    <div class="bg-green-100 p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-green-800 mb-2">Available Books</h3>
                        <p class="text-3xl font-bold text-green-900">${books.filter(book => book.available).length}</p>
                    </div>
                    <div class="bg-yellow-100 p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-yellow-800 mb-2">Issued Books</h3>
                        <p class="text-3xl font-bold text-yellow-900">${issuedBooks.filter(item => item.userId === currentUser.libraryNumber).length}</p>
                    </div>
                </div>
                <p class="mt-8 text-gray-600">Use the navigation bar above to explore books, manage your issued items, and update your profile.</p>
            </div>
        `;
    }

    function renderBooks(searchTerm = '') {
        updateActiveNav('books');
        const filteredBooks = books.filter(book =>
            book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
            book.author.toLowerCase().includes(searchTerm.toLowerCase())
        );
        contentDiv.innerHTML = `
            <div class="card p-6">
                <h2 class="text-2xl font-bold text-blue-700 mb-6">All Books</h2>
                <div id="booksList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${filteredBooks.length > 0 ? filteredBooks.map(book => `
                        <div class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 mb-1">${book.title}</h3>
                                <p class="text-sm text-gray-600 mb-3">by ${book.author}</p>
                            </div>
                            ${book.available ? `
                                <button onclick="issueBook('${book.id}')" class="btn-primary mt-4 w-full">Issue Book</button>
                            ` : `
                                <button class="btn-secondary mt-4 w-full cursor-not-allowed opacity-70" disabled>Not Available</button>
                            `}
                        </div>
                    `).join('') : '<p class="text-gray-600">No books found matching your search.</p>'}
                </div>
            </div>
        `;
    }

    function renderMyIssuedBooks() {
        updateActiveNav('myIssuedBooks');
        const userIssuedBooks = issuedBooks.filter(item => item.userId === currentUser.libraryNumber);
        contentDiv.innerHTML = `
            <div class="card p-6">
                <h2 class="text-2xl font-bold text-blue-700 mb-6">My Issued Books</h2>
                <div id="myIssuedBooksList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${userIssuedBooks.length > 0 ? userIssuedBooks.map(item => {
                        const book = books.find(b => b.id === item.bookId);
                        return book ? `
                            <div class="bg-blue-50 p-4 rounded-lg shadow-sm border border-blue-200 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold text-blue-900 mb-1">${book.title}</h3>
                                    <p class="text-sm text-gray-600 mb-2">by ${book.author}</p>
                                    <p class="text-sm text-gray-500">Issued On: ${item.issueDate}</p>
                                </div>
                                <button onclick="returnBook('${book.id}')" class="btn-danger mt-4 w-full">Return Book</button>
                            </div>
                        ` : '';
                    }).join('') : '<p class="text-gray-600">You have not issued any books yet.</p>'}
                </div>
            </div>
        `;
    }

    function renderFine() {
        updateActiveNav('fine');
        contentDiv.innerHTML = `
            <div class="card p-6">
                <h2 class="text-2xl font-bold text-blue-700 mb-6">Fine Details</h2>
                <p class="text-lg text-gray-700 mb-4">Currently, there are no outstanding fines on your account.</p>
                <p class="text-gray-600">Fines may be incurred for overdue books. Please return books on time to avoid charges.</p>
            </div>
        `;
    }

    async function issueBook(bookId) {
        const book = books.find(b => b.id === bookId);
        if (!book) {
            await showMessageModal('Error', 'Book not found.');
            return;
        }
        if (!book.available) {
            await showMessageModal('Info', `${book.title} is currently not available.`);
            return;
        }
        const alreadyIssued = issuedBooks.some(item => item.bookId === bookId && item.userId === currentUser.libraryNumber);
        if (alreadyIssued) {
            await showMessageModal('Info', `You have already issued "${book.title}". You can only issue a book once.`);
            return;
        }
        const confirmed = await showMessageModal('Confirm Issue', `Are you sure you want to issue "${book.title}"?`, true);
        if (confirmed) {
            book.available = false;
            issuedBooks.push({
                bookId: book.id,
                userId: currentUser.libraryNumber,
                issueDate: new Date().toISOString().slice(0, 10)
            });
            await showMessageModal('Success', `"${book.title}" has been successfully issued to you!`);
            renderBooks(searchBar.value);
            renderDashboard();
        }
    }

    async function returnBook(bookId) {
        const book = books.find(b => b.id === bookId);
        const issuedIndex = issuedBooks.findIndex(item => item.bookId === bookId && item.userId === currentUser.libraryNumber);
        if (!book || issuedIndex === -1) {
            await showMessageModal('Error', 'Book not found or not issued to you.');
            return;
        }
        const confirmed = await showMessageModal('Confirm Return', `Are you sure you want to return "${book.title}"?`, true);
        if (confirmed) {
            book.available = true;
            issuedBooks.splice(issuedIndex, 1);
            await showMessageModal('Success', `"${book.title}" has been successfully returned!`);
            renderMyIssuedBooks();
            renderBooks(searchBar.value);
            renderDashboard();
        }
    }

    async function handleChangePassword(event) {
        event.preventDefault();
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;
        passwordChangeMessage.textContent = '';
        const storedUserString = localStorage.getItem('registeredUser');
        let registeredUser = null;
        if (storedUserString) {
            try {
                registeredUser = JSON.parse(storedUserString);
            } catch (e) {
                console.error("Error parsing stored user data:", e);
                passwordChangeMessage.textContent = 'Error: Could not retrieve user data.';
                passwordChangeMessage.classList.remove('text-green-600');
                passwordChangeMessage.classList.add('text-red-600');
                return;
            }
        } else {
            passwordChangeMessage.textContent = 'No registered user found. Please register first.';
            passwordChangeMessage.classList.remove('text-green-600');
            passwordChangeMessage.classList.add('text-red-600');
            return;
        }
        if (currentPassword !== registeredUser.password) {
            passwordChangeMessage.textContent = 'Incorrect current password.';
            passwordChangeMessage.classList.remove('text-green-600');
            passwordChangeMessage.classList.add('text-red-600');
            return;
        }
        if (newPassword.length < 6) {
            passwordChangeMessage.textContent = 'New password must be at least 6 characters long.';
            passwordChangeMessage.classList.remove('text-green-600');
            passwordChangeMessage.classList.add('text-red-600');
            return;
        }
        if (newPassword !== confirmNewPassword) {
            passwordChangeMessage.textContent = 'New password and confirm password do not match.';
            passwordChangeMessage.classList.remove('text-green-600');
            passwordChangeMessage.classList.add('text-red-600');
            return;
        }
        registeredUser.password = newPassword;
        localStorage.setItem('registeredUser', JSON.stringify(registeredUser));
        currentUser.password = newPassword;
        passwordChangeMessage.textContent = 'Password changed successfully!';
        passwordChangeMessage.classList.remove('text-red-600');
        passwordChangeMessage.classList.add('text-green-600');
        setTimeout(() => {
            closeModal('changePasswordModal');
            passwordChangeMessage.textContent = '';
            changePasswordForm.reset();
        }, 1500);
    }

    async function handleLogout() {
        const confirmed = await showMessageModal('Confirm Logout', 'Are you sure you want to log out?', true);
        if (confirmed) {
            window.location.href = 'login.html';
        }
    }

    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const section = e.target.dataset.section;
            if (section === 'dashboard') renderDashboard();
            else if (section === 'books') renderBooks(searchBar.value);
            else if (section === 'myIssuedBooks') renderMyIssuedBooks();
            else if (section === 'fine') renderFine();
        });
    });

    searchBar.addEventListener('input', () => {
        if (document.querySelector('.nav-link.active').dataset.section === 'books') {
            renderBooks(searchBar.value);
        }
    });

    userOptionsBtn.addEventListener('click', () => {
        userOptionsDropdown.classList.toggle('hidden');
    });

    document.addEventListener('click', (event) => {
        if (!userOptionsBtn.contains(event.target) && !userOptionsDropdown.contains(event.target)) {
            userOptionsDropdown.classList.add('hidden');
        }
    });

    changePasswordLink.addEventListener('click', (e) => {
        e.preventDefault();
        userOptionsDropdown.classList.add('hidden');
        openModal('changePasswordModal');
    });

    logoutLink.addEventListener('click', (e) => {
        e.preventDefault();
        userOptionsDropdown.classList.add('hidden');
        handleLogout();
    });

    changePasswordForm.addEventListener('submit', handleChangePassword);

    document.addEventListener('DOMContentLoaded', () => {
        const storedUserString = localStorage.getItem('registeredUser');
        if (storedUserString) {
            try {
                const registeredUser = JSON.parse(storedUserString);
                currentUser.password = registeredUser.password;
            } catch (e) {
                console.error("Error parsing stored user data on load:", e);
            }
        }
        libraryIdDisplay.textContent = currentUser.libraryNumber;
        renderDashboard();
    });
</script>

</body>
</html>


